"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getUserLocale = exports.getLocaleText = exports.configureUserLocale = exports.configureGlobalLocaleText = void 0;
var _localeTextConstants = require("./localeTextConstants");
// Armazenar a configuração global de locale (imutável)
let globalLocaleText = Object.freeze({
  ..._localeTextConstants.DEFAULT_LOCALE_TEXT
});

// Armazena a configuração de localização do usuário (imutável)
let userLocale = Object.freeze({
  locale: 'en-US' // Valor padrão, pode ser alterado
});
const throttleWithLimit = (func, delay, maxCalls) => {
  let lastCall = 0;
  let callCount = 0;
  return function () {
    const now = new Date().getTime();

    // Verifica se a função já foi chamada o número máximo de vezes
    if (callCount >= maxCalls) {
      console.warn(`Função chamada mais de ${maxCalls} vezes. Execução bloqueada.`);
      return;
    }

    // Verifica se passou o tempo necessário (delay) para executar novamente
    if (now - lastCall >= delay) {
      lastCall = now;
      callCount++;
      return func(...arguments);
    }
  };
};

// Função para sobrescrever a configuração global de texto (com throttle)
const configureGlobalLocaleText = exports.configureGlobalLocaleText = throttleWithLimit(newLocaleText => {
  globalLocaleText = Object.freeze({
    ...globalLocaleText,
    ...newLocaleText
  });
}, 100, 50); // Executa no máximo uma vez a cada 100ms

// Função para configurar a localização do usuário (com throttle)
const configureUserLocale = exports.configureUserLocale = throttleWithLimit(newLocale => {
  if (newLocale && typeof newLocale.locale === 'string') {
    userLocale = Object.freeze({
      ...userLocale,
      ...newLocale
    });
  } else {
    console.warn('Locale inválido fornecido.');
  }
}, 100, 50); // Executa no máximo uma vez a cada 100ms

// Função para obter o texto localizado (global)
const getLocaleText = () => {
  return {
    ...globalLocaleText
  }; // Retorna uma cópia para evitar mutações externas
};

// Função para obter a localização do usuário
exports.getLocaleText = getLocaleText;
const getUserLocale = () => {
  return {
    ...userLocale
  }; // Retorna uma cópia para evitar mutações externas
};
exports.getUserLocale = getUserLocale;